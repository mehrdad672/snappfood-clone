!function(){function c(){for(var e=0,t={};e<arguments.length;e++){var r,n=arguments[e];for(r in n)t[r]=n[r]}return t}function d(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}var a,b;function supportsLocalStorage(){try{return localStorage.setItem("1","1"),localStorage.removeItem("1"),!0}catch(e){return!1}}function supportsCookie(){try{return Cookies.set("1","1"),Cookies.remove("1"),!0}catch(e){return!1}}a=window.Cookies,b=window.Cookies=function e(u){function i(){}function r(e,t,r){if("undefined"!=typeof document){"number"==typeof(r=c({path:"/"},i.defaults,r)).expires&&(r.expires=new Date(+new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var n=JSON.stringify(t);/^[\{\[]/.test(n)&&(t=n)}catch(e){}t=u.write?u.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a,o="";for(a in r)r[a]&&(o+="; "+a,!0!==r[a]&&(o+="="+r[a].split(";")[0]));return document.cookie=e+"="+t+o}}function t(e,t){if("undefined"!=typeof document){for(var r={},n=document.cookie?document.cookie.split("; "):[],a=0;a<n.length;a++){var o=n[a].split("="),i=o.slice(1).join("=");t||'"'!==i.charAt(0)||(i=i.slice(1,-1));try{var s=d(o[0]),i=(u.read||u)(i,s)||d(i);if(t)try{i=JSON.parse(i)}catch(e){}if(r[s]=i,e===s)break}catch(e){}}return e?r[e]:r}}return i.set=r,i.get=function(e){return t(e,!1)},i.getJSON=function(e){return t(e,!0)},i.remove=function(e,t){r(e,"",c(t,{expires:-1}))},i.defaults={},i.withConverter=e,i}(function(){}),b.noConflict=function(){return window.Cookies=a,b};var useLocalStorage=supportsLocalStorage(),useCookie=!useLocalStorage&&supportsCookie();function store(e,t,r){useLocalStorage?localStorage.setItem(e,t):useCookie&&Cookies.set(e,t,{expires:r})}function del(e){useLocalStorage?localStorage.removeItem(e):useCookie&&Cookies.remove(e)}function storeWithTtl(e,t,r){store(e,t,r),store(e+":t",Date.now(),r)}function load(e){return useLocalStorage?localStorage.getItem(e):useCookie?Cookies.get(e):null}function loadIfNotExpired(e,t){var r=load(e),n=load(e+":t");if(n){n=Date.now()-n;if(n<0||t<n)return del(e),del(e+":t"),null}return r}function once(e,t){if(!load(e)){store(e,1,999);try{t()}catch(e){console.log(e)}}}function doInSession(e,t){sessionStorage.setItem(e,"1");try{t()}catch(e){console.log(e)}}function doOnceInSession(e,t){sessionStorage.getItem(e)||doInSession(e,t)}var eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventer=window[eventMethod],messageEvent="attachEvent"===eventMethod?"onmessage":"message",fidKey="MEDIAAD_USER_ID",fidHolder={val:null,listeners:[],set value(e){for(this.val=e;0<this.listeners.length;)this.listeners.pop()(e)},get value(){return this.val},listen:function(e){this.listeners.push(e)}},queryParams;function withFid(t){var e=fidHolder.value;if(e)try{t(e)}catch(e){console.log(e)}else fidHolder.listen(function(e){if(e)try{t(e)}catch(e){console.log(e)}})}function docReady(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)}function getCurrentPath(){return decodeURIComponent(location.href.substr(location.origin.length))}function appendIframe(e){if(null!=e){var t=document.createElement("iframe");t.style.display="none",t.src=e;try{document.body.appendChild(t)}catch(e){console.log(e)}}}function extractUserId(){function e(e){e=e.match(/mediaad.org\/serve\/([^/]+)\/retargeting\.js$/);return e?e[1]:null}var t;if(document.currentScript instanceof HTMLScriptElement&&(t=e(document.currentScript.src)))return t;for(var r=document.getElementsByTagName("script"),n=0;n<r.length;n++){var a=r.item(n);if(a&&a.src&&(t=e(a.src)))return t}return null}fidHolder.value=load(fidKey),eventer(messageEvent,function(e){try{var t=e.data||e.message;if(null==t||void 0===t.indexOf)return;0===t.indexOf("mediaad-fid:")&&(t=t.split(":")[1],fidHolder.value=t,store(fidKey,t,999))}catch(e){console.log(e)}}),"URLSearchParams"in window?(queryParams=new URLSearchParams(window.location.search),queryParams.has("utm_ma")&&storeWithTtl("ma-iid",queryParams.get("utm_ma"),1)):(queryParams=window.location.search.substr(1).split("&").reduce(function(e,t){var r=t.split("="),t=r[0],r=decodeURIComponent(r[1]),r=isNaN(Number(r))?r:Number(r);return e[t]=r,e},{}),queryParams.utm_ma&&storeWithTtl("ma-iid",queryParams.utm_ma,1));var data={},htmlElementTagToCounter={},tagToTimeoutCounter={},currentPath=getCurrentPath(),timeouts=[],userId=extractUserId();function checkUrlChange(){var e=getCurrentPath();e!==currentPath&&(currentPath=e,refresh())}function refresh(){var t=timeouts.slice();timeouts=[];var r=0;0===t.length?processPage():t.forEach(function(e){clearTimeout(e),++r===t.length&&processPage()})}function processPage(){informPageLoaded(),tagToTimeoutCounter={},htmlElementTagToCounter={},data.tags.forEach(function(t){testMatcherAsync(t,function(e){e&&applyTriggerEvent(t)})})}function informPageLoaded(){if(!data.has_product_js){var matchedFeed,matchedCrawlers=[];if(data.crawlers)for(var i=0;i<data.crawlers.length;i++){var crawler=data.crawlers[i],matched;if(matchedFeed&&crawler.feed_id!==matchedFeed)break;testMatcher(crawler)&&(matched=!0,crawler.post_condition_code&&(matched=!0===eval(crawler.post_condition_code)),matched&&(matchedFeed=crawler.feed_id,matchedCrawlers.push(crawler.crawler_id)))}var pageUrl=location.href.split("#")[0];withFid(function(r){var e,t,n={l:pageUrl};0<matchedCrawlers.length&&(n.p=1,n.c=matchedCrawlers.toString()),r&&(n.m=r,useLocalStorage&&(e=localStorage.getItem("_yngt"),t=localStorage.getItem("sid"),e&&(n.y=e),t&&(n.s=t))),postJson(apiUrl("/v2/events/page/loaded"),n,function(e){var t;e&&0<e.length&&(t="/v2/events/page/content?t="+e+"&l="+encodeURIComponent(pageUrl)+(0<matchedCrawlers.length?"&p=1&c="+matchedCrawlers.toString():"")+(r?"&fid="+r:""),import("https://mediacdn.mediaad.org/7/25/asset/js/pako_deflate.min.js").then(function(){var e=new Blob([pako.gzip(document.documentElement.outerHTML,{to:"string"})]);post(apiUrl(t),e,{"Content-Type":"application/octet-stream","Content-Encoding":"gzip"})}))})})}}function loadAttribsValues(t){var r={};return t.attribs&&t.attribs.forEach(function(e){r[e.id]=loadAttribValues(t,e)}),r}function loadAttribValues(tag,attrib){var vs;try{vs=eval(attrib.script)}catch(e){console.log(e)}if(vs){var res={};return vs.forEach(function(e){res[e]?res[e]++:res[e]=1}),res}return{}}function domainMatches(e){if(e.domain){var t=location.hostname;return t===e.domain||t==="www."+e.domain||"www."+t===e.domain}return 1}function testMatcher(e){return domainMatches(e)&&("equalsTo"===e.pattern_type?currentPath===e.query:"contains"===e.pattern_type?currentPath.includes(e.query):"startsWith"===e.pattern_type?currentPath.startsWith(e.query):"endsWith"===e.pattern_type?currentPath.endsWith(e.query):"regex"===e.pattern_type?new RegExp(e.query).test(currentPath):"htmlElement"===e.pattern_type&&null!=(document.getElementById(e.query)||document.querySelector(e.query)))}function testMatcherAsync(t,r){var n;domainMatches(t)?"equalsTo"===t.pattern_type?r(currentPath===t.query):"contains"===t.pattern_type?r(currentPath.includes(t.query)):"startsWith"===t.pattern_type?r(currentPath.startsWith(t.query)):"endsWith"===t.pattern_type?r(currentPath.endsWith(t.query)):"regex"===t.pattern_type?r(new RegExp(t.query).test(currentPath)):"htmlElement"===t.pattern_type&&(htmlElementTagToCounter[t.id]=0,n=setInterval(function(){htmlElementTagToCounter[t.id]=htmlElementTagToCounter[t.id]+1;var e=null!=(document.getElementById(t.query)||document.querySelector(t.query));(e||htmlElementTagToCounter[t.id]>=data.max_interval_reset)&&(clearInterval(n),r(e))},1e3),timeouts.push(n)):r(!1)}function applyTriggerEvent(tag){if("showPage"===tag.trigger_type)assignTagToUser(tag);else if("clickOnElement"===tag.trigger_type){tag.css_selector in tagToTimeoutCounter||(tagToTimeoutCounter[tag.css_selector]=0);var clickOnElementCheckInterval=setInterval(function(){tagToTimeoutCounter[tag.css_selector]=tagToTimeoutCounter[tag.css_selector]+1;var e=Array.prototype.slice.call(document.querySelectorAll(tag.css_selector));(0<e.length||tagToTimeoutCounter[tag.css_selector]>=data.max_interval_reset)&&clearInterval(clickOnElementCheckInterval),e.forEach(function(e){e.addEventListener("click",function(){assignTagToUser(tag)})})},1e3);timeouts.push(clickOnElementCheckInterval)}else if("submitForm"===tag.trigger_type){tag.css_selector in tagToTimeoutCounter||(tagToTimeoutCounter[tag.css_selector]=0);var submitFormCheckInterval=setInterval(function(){tagToTimeoutCounter[tag.css_selector]=tagToTimeoutCounter[tag.css_selector]+1;var e=Array.prototype.slice.call(document.querySelectorAll(tag.css_selector));(0<e.length||tagToTimeoutCounter[tag.css_selector]>=data.max_interval_reset)&&clearInterval(submitFormCheckInterval),e.forEach(function(e){e.addEventListener("submit",function(){assignTagToUser(tag)})})},1e3);timeouts.push(submitFormCheckInterval)}else if("timeToStay"===tag.trigger_type){var timeout=setTimeout(function(){assignTagToUser(tag)},1e3*tag.time_to_remain);timeouts.push(timeout)}else if("customScript"===tag.trigger_type)try{var result=eval(tag.custom_script);!0===result&&assignTagToUser(tag)}catch(e){console.log(e)}}function assignTagToUser(t){var e=loadIfNotExpired("ma-iid",36e5);e&&once("ma-pb:"+e,function(){get(apiUrl("/v1/events/post-back?actionName="+t.title+"&clickId="+e))});var r="ma-tag:"+t.id,n=loadAttribsValues(t);0<Object.keys(n).length?doInSession(r,function(){withFid(function(e){postJson(apiUrl("/v1/events/tag?fid="+e),{tagId:t.id,av:n})})}):doOnceInSession(r,function(){withFid(function(e){postJson(apiUrl("/v1/events/tag?fid="+e),{tagId:t.id})})})}function apiUrl(e){return data.system_api_url+e}function postJson(e,t,r){post(e,JSON.stringify(t),{"Content-Type":"application/json; charset=utf-8"},r)}function post(e,t,r,n){var a=new XMLHttpRequest;n&&(a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&n(a.response)}),a.open("POST",e),a.withCredentials=!0,Object.entries(r).forEach(function(e){a.setRequestHeader(e[0],e[1])}),t?a.send(t):a.send()}function get(e,t){var r=new XMLHttpRequest;t&&(r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&t(r.response)}),r.open("GET",e),r.send(null)}userId&&get("https://ma-cdn.pegah.tech/v1/retargeting/"+userId+"/advertiser.json",function(e){try{data=JSON.parse(e)}catch(e){console.log(e)}data.system_api_url&&docReady(function(){appendIframe("https://mediacdn.mediaad.org/static/fingerprint.html"),setTimeout(function(){get(apiUrl("/v1/events/session/10"))},1e4),processPage(),setInterval(function(){checkUrlChange()},1e3)})})}();!function(){function checkSupportLocalStorage(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}}!function(){var e=window.Cookies,t=window.Cookies=function e(u){function i(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=l({path:"/"},i.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var r=JSON.stringify(t);/^[\{\[]/.test(r)&&(t=r)}catch(e){}t=u.write?u.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o,a="";for(o in n)n[o]&&(a+="; "+o,!0!==n[o]&&(a+="="+n[o].split(";")[0]));return document.cookie=e+"="+t+a}}function t(e,t){if("undefined"!=typeof document){for(var n={},r=document.cookie?document.cookie.split("; "):[],o=0;o<r.length;o++){var a=r[o].split("="),i=a.slice(1).join("=");t||'"'!==i.charAt(0)||(i=i.slice(1,-1));try{var l=d(a[0]),i=(u.read||u)(i,l)||d(i);if(t)try{i=JSON.parse(i)}catch(e){}if(n[l]=i,e===l)break}catch(e){}}return e?n[e]:n}}return i.set=n,i.get=function(e){return t(e,!1)},i.getJSON=function(e){return t(e,!0)},i.remove=function(e,t){n(e,"",l(t,{expires:-1}))},i.defaults={},i.withConverter=e,i}(function(){});function l(){for(var e=0,t={};e<arguments.length;e++){var n,r=arguments[e];for(n in r)t[n]=r[n]}return t}function d(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}t.noConflict=function(){return window.Cookies=e,t}}();var useLocalStorage=checkSupportLocalStorage();function getFromLocalStorage(e){return localStorage.getItem(e)}function docReady(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)}var propertySelector={title:{selector:"title",field:"innerText",required:!0,value:null,code:null},image:{selector:".kk-image-container > img",field:"src",required:!0,value:null,code:null},available:{selector:"",field:"",required:!0,value:null,code:"document.querySelector('#common-modal').style.display === ''"}},campaignId=4985,API_URL="https://api.mediaad.org",uidKey="MEDIAAD_USER_ID",eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventer=window[eventMethod],messageEvent="attachEvent"===eventMethod?"onmessage":"message",loadEvent="attachEvent"===eventMethod?"onload":"load",uidHolder={val:null,listeners:[],set value(e){for(this.val=e;0<this.listeners.length;)this.listeners.pop()(e)},get value(){return this.val},listen:function(e){this.listeners.push(e)}};function withUid(t){var e=uidHolder.value;if(e)try{t(e)}catch(e){}else uidHolder.listen(function(e){if(e)try{t(e)}catch(e){}})}useLocalStorage?uidHolder.value=getFromLocalStorage(uidKey):Cookies.get(uidKey)&&(uidHolder.value=Cookies.get(uidKey)),eventer(messageEvent,function(e){try{var t=e.data||e.message;null!=t&&void 0!==t.indexOf&&0===t.indexOf("mediaad-fid:")&&(uidHolder.value=t.split(":")[1])}catch(e){console.log(e)}});var persianNumbers=[/۰/g,/۱/g,/۲/g,/۳/g,/۴/g,/۵/g,/۶/g,/۷/g,/۸/g,/۹/g],arabicNumbers=[/٠/g,/١/g,/٢/g,/٣/g,/٤/g,/٥/g,/٦/g,/٧/g,/٨/g,/٩/g],fixNumbers=function(e){if("string"==typeof e)for(var t=0;t<10;t++)e=e.replace(persianNumbers[t],t).replace(arabicNumbers[t],t);return e};function getCurrentUrl(){return decodeURIComponent(location.href)}function getCurrentState(){return getFieldValue("state")}function getLinkedData(){return getFieldValue("ld")}function getLink(){var e=getFieldValue("link");return e||window.location.href.split("#")[0]}var hasRequiredElements=!0,url=getCurrentUrl(),state=getCurrentState(),pageLoadInformed=!1,ld=null,link=null;function findElementAndValue(e){var t,n=propertySelector[e];return n&&(t=n.selector)&&(t=document.querySelector(t))?null!==propertySelector[e].value?t[n.field]===propertySelector[e].value:"style.bg"===n.field?getBgImageUrl(t):"computedStyle.bg"===n.field?getComputedBgImageUrl(t):t[n.field]:null}function getBgImageUrl(e){return extractUrlValue(e.style.backgroundImage)}function getComputedBgImageUrl(e){return extractUrlValue(window.getComputedStyle(e).getPropertyValue("background-image"))}function extractUrlValue(e){return e.match(/url\(["']?([^"']*)["']?\)/)[1]}function getFieldValue(name){var result;if(propertySelector[name]&&propertySelector[name].code)try{result=eval(propertySelector[name].code)}catch(err){result=null}else result=findElementAndValue(name);return checkRequired(name,result),result}function checkRequired(e,t){null==t&&propertySelector[e]&&propertySelector[e].required&&(hasRequiredElements=!1)}function run(){setTimeout(function(){withUid(send)},3e3)}function send(e){ld=getLinkedData();var t="med-prod:"+(link=getLink()),n=sessionStorage.getItem(t);n?informPageLoaded(parseInt(n),e):(sendWith(e,link,t),sessionStorage.getItem(t)||(informPageLoaded(0,e),-1!==url.indexOf("utm_ma=")&&deleteProduct(link)))}function sendWith(e,t,n){var r,o,a,i,l,u,d,c,s;window.location.href.includes("/restaurant/menu/")&&(hasRequiredElements=!0,r=getFieldValue("sku"),o=getFieldValue("title"),a=getFieldValue("category"),i=getFieldValue("fullCategory"),l=getFieldValue("price"),u=getFieldValue("oldPrice"),d=getFieldValue("image"),c=getFieldValue("exp"),s=getFieldValue("available"),null!==o&&(o=o.replace(/(\s|\u0633\u0648\u067e\u0631\u0645\u0627\u0631\u06a9\u062a \u0632\u0646\u062c\u06cc\u0631\u0647\u200c\u0627\u06cc)+/gm," ").trim()),null!==d&&(d=d.replace("/200x201","")),t.includes("0ynwmp/bergerestan")&&(s=!1),informPageLoaded(hasRequiredElements?1:0,e),hasRequiredElements?postJson("/v1/events/product?fid="+e,{campaignId:campaignId,link:t,sku:r,title:o,category:a,fullCategory:i,image:d,price:l,oldPrice:u,exp:c,available:!1!==s}):deleteProduct(t),sessionStorage.setItem(n,hasRequiredElements?"1":"0"))}function deleteProduct(e){postJson("/v1/events/deleted-product",{campaignId:campaignId,link:e})}function informPageLoaded(n,r){pageLoadInformed||(pageLoadInformed=!0,postJson("/v2/events/page/loaded",pageLoadBody(n,r),function(e){var t;e&&0<e.length&&(t="/v2/events/page/content?t="+e+"&p="+n+(n?"&c="+campaignId:"")+"&l="+encodeURIComponent(link)+(r?"&fid="+r:""),import("https://mediacdn.mediaad.org/7/25/asset/js/pako_deflate.min.js").then(function(){var e=new Blob([pako.gzip(document.documentElement.outerHTML,{to:"string"})]);post(t,e,{"Content-Type":"application/octet-stream","Content-Encoding":"gzip"})}))}))}function pageLoadBody(e,t){var n={p:e,l:link};return e&&(n.c=campaignId),t&&(n.m=t,useLocalStorage&&(e=localStorage.getItem("_yngt"),t=localStorage.getItem("sid"),e&&(n.y=e),t&&(n.s=t))),n}function postJson(e,t,n){post(e,JSON.stringify(t),{"Content-Type":"application/json; charset=utf-8"},n)}function post(e,t,n,r){var o=new XMLHttpRequest;r&&(o.onreadystatechange=function(){4===o.readyState&&r(o.response)}),o.open("POST",API_URL+e),o.withCredentials=!0,Object.entries(n).forEach(function(e){o.setRequestHeader(e[0],e[1])}),t?o.send(t):o.send()}docReady(run),eventer(loadEvent,run),setInterval(function(){var e=getCurrentUrl(),t=getCurrentState();url===e&&state===t||(url=e,state=t,pageLoadInformed=!1,run())},1500)}();